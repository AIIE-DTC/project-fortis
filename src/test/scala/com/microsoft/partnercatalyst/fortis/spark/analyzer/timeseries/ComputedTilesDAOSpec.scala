package com.microsoft.partnercatalyst.fortis.spark.analyzer.timeseries

import java.text.SimpleDateFormat
import java.util.Date

import org.scalatest.FlatSpec

class ComputedTilesDAOSpec extends FlatSpec {

  private var dao: ComputedTilesDAO = new ComputedTilesDAO()
  private var referenceDate: Date = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").parse("2016-10-30 15:34:56")

  "SequentialNestedSuiteExecution retrospectivePeriods" should "produce 4 hours from Minute." in {
    val periods = dao.retrospectivePeriods(PeriodType.Minute, referenceDate.getTime)
    val expected = List("2016-10-30 11:35", "2016-10-30 11:36", "2016-10-30 11:37", "2016-10-30 11:38", "2016-10-30 11:39", "2016-10-30 11:40", "2016-10-30 11:41", "2016-10-30 11:42", "2016-10-30 11:43", "2016-10-30 11:44", "2016-10-30 11:45", "2016-10-30 11:46", "2016-10-30 11:47", "2016-10-30 11:48", "2016-10-30 11:49", "2016-10-30 11:50", "2016-10-30 11:51", "2016-10-30 11:52", "2016-10-30 11:53", "2016-10-30 11:54", "2016-10-30 11:55", "2016-10-30 11:56", "2016-10-30 11:57", "2016-10-30 11:58", "2016-10-30 11:59", "2016-10-30 12:00", "2016-10-30 12:01", "2016-10-30 12:02", "2016-10-30 12:03", "2016-10-30 12:04", "2016-10-30 12:05", "2016-10-30 12:06", "2016-10-30 12:07", "2016-10-30 12:08", "2016-10-30 12:09", "2016-10-30 12:10", "2016-10-30 12:11", "2016-10-30 12:12", "2016-10-30 12:13", "2016-10-30 12:14", "2016-10-30 12:15", "2016-10-30 12:16", "2016-10-30 12:17", "2016-10-30 12:18", "2016-10-30 12:19", "2016-10-30 12:20", "2016-10-30 12:21", "2016-10-30 12:22", "2016-10-30 12:23", "2016-10-30 12:24", "2016-10-30 12:25", "2016-10-30 12:26", "2016-10-30 12:27", "2016-10-30 12:28", "2016-10-30 12:29", "2016-10-30 12:30", "2016-10-30 12:31", "2016-10-30 12:32", "2016-10-30 12:33", "2016-10-30 12:34", "2016-10-30 12:35", "2016-10-30 12:36", "2016-10-30 12:37", "2016-10-30 12:38", "2016-10-30 12:39", "2016-10-30 12:40", "2016-10-30 12:41", "2016-10-30 12:42", "2016-10-30 12:43", "2016-10-30 12:44", "2016-10-30 12:45", "2016-10-30 12:46", "2016-10-30 12:47", "2016-10-30 12:48", "2016-10-30 12:49", "2016-10-30 12:50", "2016-10-30 12:51", "2016-10-30 12:52", "2016-10-30 12:53", "2016-10-30 12:54", "2016-10-30 12:55", "2016-10-30 12:56", "2016-10-30 12:57", "2016-10-30 12:58", "2016-10-30 12:59", "2016-10-30 13:00", "2016-10-30 13:01", "2016-10-30 13:02", "2016-10-30 13:03", "2016-10-30 13:04", "2016-10-30 13:05", "2016-10-30 13:06", "2016-10-30 13:07", "2016-10-30 13:08", "2016-10-30 13:09", "2016-10-30 13:10", "2016-10-30 13:11", "2016-10-30 13:12", "2016-10-30 13:13", "2016-10-30 13:14", "2016-10-30 13:15", "2016-10-30 13:16", "2016-10-30 13:17", "2016-10-30 13:18", "2016-10-30 13:19", "2016-10-30 13:20", "2016-10-30 13:21", "2016-10-30 13:22", "2016-10-30 13:23", "2016-10-30 13:24", "2016-10-30 13:25", "2016-10-30 13:26", "2016-10-30 13:27", "2016-10-30 13:28", "2016-10-30 13:29", "2016-10-30 13:30", "2016-10-30 13:31", "2016-10-30 13:32", "2016-10-30 13:33", "2016-10-30 13:34", "2016-10-30 13:35", "2016-10-30 13:36", "2016-10-30 13:37", "2016-10-30 13:38", "2016-10-30 13:39", "2016-10-30 13:40", "2016-10-30 13:41", "2016-10-30 13:42", "2016-10-30 13:43", "2016-10-30 13:44", "2016-10-30 13:45", "2016-10-30 13:46", "2016-10-30 13:47", "2016-10-30 13:48", "2016-10-30 13:49", "2016-10-30 13:50", "2016-10-30 13:51", "2016-10-30 13:52", "2016-10-30 13:53", "2016-10-30 13:54", "2016-10-30 13:55", "2016-10-30 13:56", "2016-10-30 13:57", "2016-10-30 13:58", "2016-10-30 13:59", "2016-10-30 14:00", "2016-10-30 14:01", "2016-10-30 14:02", "2016-10-30 14:03", "2016-10-30 14:04", "2016-10-30 14:05", "2016-10-30 14:06", "2016-10-30 14:07", "2016-10-30 14:08", "2016-10-30 14:09", "2016-10-30 14:10", "2016-10-30 14:11", "2016-10-30 14:12", "2016-10-30 14:13", "2016-10-30 14:14", "2016-10-30 14:15", "2016-10-30 14:16", "2016-10-30 14:17", "2016-10-30 14:18", "2016-10-30 14:19", "2016-10-30 14:20", "2016-10-30 14:21", "2016-10-30 14:22", "2016-10-30 14:23", "2016-10-30 14:24", "2016-10-30 14:25", "2016-10-30 14:26", "2016-10-30 14:27", "2016-10-30 14:28", "2016-10-30 14:29", "2016-10-30 14:30", "2016-10-30 14:31", "2016-10-30 14:32", "2016-10-30 14:33", "2016-10-30 14:34", "2016-10-30 14:35", "2016-10-30 14:36", "2016-10-30 14:37", "2016-10-30 14:38", "2016-10-30 14:39", "2016-10-30 14:40", "2016-10-30 14:41", "2016-10-30 14:42", "2016-10-30 14:43", "2016-10-30 14:44", "2016-10-30 14:45", "2016-10-30 14:46", "2016-10-30 14:47", "2016-10-30 14:48", "2016-10-30 14:49", "2016-10-30 14:50", "2016-10-30 14:51", "2016-10-30 14:52", "2016-10-30 14:53", "2016-10-30 14:54", "2016-10-30 14:55", "2016-10-30 14:56", "2016-10-30 14:57", "2016-10-30 14:58", "2016-10-30 14:59", "2016-10-30 15:00", "2016-10-30 15:01", "2016-10-30 15:02", "2016-10-30 15:03", "2016-10-30 15:04", "2016-10-30 15:05", "2016-10-30 15:06", "2016-10-30 15:07", "2016-10-30 15:08", "2016-10-30 15:09", "2016-10-30 15:10", "2016-10-30 15:11", "2016-10-30 15:12", "2016-10-30 15:13", "2016-10-30 15:14", "2016-10-30 15:15", "2016-10-30 15:16", "2016-10-30 15:17", "2016-10-30 15:18", "2016-10-30 15:19", "2016-10-30 15:20", "2016-10-30 15:21", "2016-10-30 15:22", "2016-10-30 15:23", "2016-10-30 15:24", "2016-10-30 15:25", "2016-10-30 15:26", "2016-10-30 15:27", "2016-10-30 15:28", "2016-10-30 15:29", "2016-10-30 15:30", "2016-10-30 15:31", "2016-10-30 15:32", "2016-10-30 15:33", "2016-10-30 15:34")
    assert(periods == expected)
  }

  it should "produce 7 days from Hour." in {
    val periods = dao.retrospectivePeriods(PeriodType.Hour, referenceDate.getTime)
    val expected = List("2016-10-23 16", "2016-10-23 17", "2016-10-23 18", "2016-10-23 19", "2016-10-23 20", "2016-10-23 21", "2016-10-23 22", "2016-10-23 23", "2016-10-24 00", "2016-10-24 01", "2016-10-24 02", "2016-10-24 03", "2016-10-24 04", "2016-10-24 05", "2016-10-24 06", "2016-10-24 07", "2016-10-24 08", "2016-10-24 09", "2016-10-24 10", "2016-10-24 11", "2016-10-24 12", "2016-10-24 13", "2016-10-24 14", "2016-10-24 15", "2016-10-24 16", "2016-10-24 17", "2016-10-24 18", "2016-10-24 19", "2016-10-24 20", "2016-10-24 21", "2016-10-24 22", "2016-10-24 23", "2016-10-25 00", "2016-10-25 01", "2016-10-25 02", "2016-10-25 03", "2016-10-25 04", "2016-10-25 05", "2016-10-25 06", "2016-10-25 07", "2016-10-25 08", "2016-10-25 09", "2016-10-25 10", "2016-10-25 11", "2016-10-25 12", "2016-10-25 13", "2016-10-25 14", "2016-10-25 15", "2016-10-25 16", "2016-10-25 17", "2016-10-25 18", "2016-10-25 19", "2016-10-25 20", "2016-10-25 21", "2016-10-25 22", "2016-10-25 23", "2016-10-26 00", "2016-10-26 01", "2016-10-26 02", "2016-10-26 03", "2016-10-26 04", "2016-10-26 05", "2016-10-26 06", "2016-10-26 07", "2016-10-26 08", "2016-10-26 09", "2016-10-26 10", "2016-10-26 11", "2016-10-26 12", "2016-10-26 13", "2016-10-26 14", "2016-10-26 15", "2016-10-26 16", "2016-10-26 17", "2016-10-26 18", "2016-10-26 19", "2016-10-26 20", "2016-10-26 21", "2016-10-26 22", "2016-10-26 23", "2016-10-27 00", "2016-10-27 01", "2016-10-27 02", "2016-10-27 03", "2016-10-27 04", "2016-10-27 05", "2016-10-27 06", "2016-10-27 07", "2016-10-27 08", "2016-10-27 09", "2016-10-27 10", "2016-10-27 11", "2016-10-27 12", "2016-10-27 13", "2016-10-27 14", "2016-10-27 15", "2016-10-27 16", "2016-10-27 17", "2016-10-27 18", "2016-10-27 19", "2016-10-27 20", "2016-10-27 21", "2016-10-27 22", "2016-10-27 23", "2016-10-28 00", "2016-10-28 01", "2016-10-28 02", "2016-10-28 03", "2016-10-28 04", "2016-10-28 05", "2016-10-28 06", "2016-10-28 07", "2016-10-28 08", "2016-10-28 09", "2016-10-28 10", "2016-10-28 11", "2016-10-28 12", "2016-10-28 13", "2016-10-28 14", "2016-10-28 15", "2016-10-28 16", "2016-10-28 17", "2016-10-28 18", "2016-10-28 19", "2016-10-28 20", "2016-10-28 21", "2016-10-28 22", "2016-10-28 23", "2016-10-29 00", "2016-10-29 01", "2016-10-29 02", "2016-10-29 03", "2016-10-29 04", "2016-10-29 05", "2016-10-29 06", "2016-10-29 07", "2016-10-29 08", "2016-10-29 09", "2016-10-29 10", "2016-10-29 11", "2016-10-29 12", "2016-10-29 13", "2016-10-29 14", "2016-10-29 15", "2016-10-29 16", "2016-10-29 17", "2016-10-29 18", "2016-10-29 19", "2016-10-29 20", "2016-10-29 21", "2016-10-29 22", "2016-10-29 23", "2016-10-30 00", "2016-10-30 01", "2016-10-30 02", "2016-10-30 03", "2016-10-30 04", "2016-10-30 05", "2016-10-30 06", "2016-10-30 07", "2016-10-30 08", "2016-10-30 09", "2016-10-30 10", "2016-10-30 11", "2016-10-30 12", "2016-10-30 13", "2016-10-30 14", "2016-10-30 15")
    assert(periods == expected)
  }

  it should "produce 30 days from Day." in {
    val periods = dao.retrospectivePeriods(PeriodType.Day, referenceDate.getTime)
    val expected = List("2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30")
    assert(periods == expected)
  }

  it should "produce 6 months from Week." in {
    val periods = dao.retrospectivePeriods(PeriodType.Week, referenceDate.getTime)
    val expected = List("2015-29", "2015-30", "2015-31", "2015-32", "2015-33", "2015-34", "2015-35", "2015-36", "2015-37", "2015-38", "2015-39", "2015-40", "2015-41", "2015-42", "2015-43", "2015-44", "2015-45", "2015-46", "2015-47", "2015-48", "2015-49", "2015-50", "2015-51", "2015-52")
    assert(periods == expected)
  }

  it should "produce 6 months from Month." in {
    val periods = dao.retrospectivePeriods(PeriodType.Month, referenceDate.getTime)
    val expected = List("2013-11", "2013-12", "2014-01", "2014-02", "2014-03", "2014-04", "2014-05", "2014-06", "2014-07", "2014-08", "2014-09", "2014-10", "2014-11", "2014-12", "2015-01", "2015-02", "2015-03", "2015-04", "2015-05", "2015-06", "2015-07", "2015-08", "2015-09", "2015-10", "2015-11", "2015-12", "2016-01", "2016-02", "2016-03", "2016-04", "2016-05", "2016-06", "2016-07", "2016-08", "2016-09", "2016-10")
    assert(periods == expected)
  }

  it should "produce 7 years from Year." in {
    val periods = dao.retrospectivePeriods(PeriodType.Year, referenceDate.getTime)
    val expected = List("2010", "2011", "2012", "2013", "2014", "2015", "2016")
    assert(periods == expected)
  }
}
